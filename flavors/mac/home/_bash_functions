# Autoload conda or venv when changing directories
cd() {
  builtin cd $@
  [ -f .conda_env ] && conda activate $(cat .conda_env)
  [ -f .venv ] && source .venv/bin/activate
}

# Run command in background
background() {
  $1 . > /dev/null 2>&1 &
}

# change ownership of all files in current dir to current user
reown() {
  GROUP=$(id -gn)
  find . -not -user $USER -exec sudo chown $USER:$GROUP -v {} \;
}

# create a backup file in parent dir
backup() {
  FILENAME=$(basename $(pwd))
  tar -cjvf ../backup-$FILENAME-`date +"%F"`.tar.bz2 --exclude .git --exclude logs  --exclude log .
  echo "Created new backup $BACKUP_NAME"
}

# clean all __pycache__ dirs (recursive)
pyclean() {
  find . -type d -name __pycache__ -exec rm -rf {} \;
}

# helper to disable ipv6 adapter
disable_ipv6() {
	networksetup -setv6off Wi-Fi
}

# helper to create and export a Bitwarden item field as env var
bw_export() {
    local bw_id=$(bw list items --search $1 | jq -r '.[0].id')
    [[ -z "$bw_id" || "$bw_id" == "null" ]] && { echo "Item not found"; exit 1; }
    local bw_key=$(bw get item $bw_id | jq -r --arg field_name "$2" '.fields[]? | select(.name==$field_name) | .value')
    export $2=$bw_key
    echo "$2 set"
}
